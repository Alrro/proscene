#summary Tersehandling call back mechanism
#sidebar TerseHandlingSideBar

<wiki:toc max_depth="1" />

A simple callback mechanism is illustrated in the example `BoringClickAndDrag`, in which we:

  # Implement a simple `TerseHandling` Agent, which transforms [http://processing.org/reference/javadoc/core/processing/event/package-summary.html Processing mouse events] into `TerseHandling` events.
  # Implement an object grabber, define its behavior, and register it at the agent.
  # Handle agents and events calling `TerseHandler.handle()` in the main event loop.

=1. A simple `TerseHandling` Agent=

Every `TerseHandling` *Agent* holds a pool of input *grabbers*, i.e., high-level objects which can react to user input, and only one of those grabbers may grabbed the agent at a given time (or none). So here we begin by implementing our first `TerseHandling` *Agent*, which will be responsible for:

  # Transforming *Processing* MouseEvents into `TerseHandling` DOF2Events.
  # Defining which `TerseHandling` event will update the grabber in the Agent pool
  # Defining which `TerseHandling` event will actually trigger an action to be performed by the grabber (if there's one selected).

{{{
public class MouseAgent extends Agent {
  //Declare a DOF2Event (two degrees-of-freedom) and a ClickEvent TerseHandling events:
  DOF2Event event;

  public MouseAgent(TerseHandler scn, String n) {
    super(scn, n);
  }

  public void mouseEvent(processing.event.MouseEvent e) {
    event = new DOF2Event(e.getX(), e.getY());
    // A Processing mouse move will update the agent grabber:
    if ( e.getAction() == processing.event.MouseEvent.MOVE )
      updateGrabber(event);
    if ( e.getAction() == processing.event.MouseEvent.DRAG )
      handle(event);
  }
}
}}}

=2. A simple object grabber=

{{{
public class GrabbableCircle extends AbstractGrabber {
  public float radius;
  public PVector center;
  public int colour;

  public GrabbableCircle(Agent agent) {
    agent.addInPool(this);
    setColor();
    setPositionAndRadius();
  }

  public GrabbableCircle(Agent agent, PVector c, float r) {
    agent.addInPool(this);
    radius = r;
    center = c;    
    setColor();
  }

  public void setColor() {
    setColor(color(random(0, 255), random(0, 255), random(0, 255)));
  }

  public void setColor(int myC) {
    colour = myC;
  }

  public void setPositionAndRadius(PVector p, float r) {
    center = p;
    radius = r;
  }

  public void setPositionAndRadius() {
    float maxRadius = 50;
    float low = maxRadius;
    float highX = w - maxRadius;
    float highY = h - maxRadius;
    setPositionAndRadius(new PVector(random(low, highX), random(low, highY)), random(20, maxRadius));
  }

  public void draw() {
    draw(colour);
  }

  public void draw(int c) {
    pushStyle();
    fill(c);
    ellipse(center.x, center.y, 2*radius, 2*radius);
    popStyle();
  }

  @Override
  public boolean checkIfGrabsInput(BaseEvent event) {
    if (event instanceof DOF2Event) {
      float x = ((DOF2Event)event).getX();
      float y = ((DOF2Event)event).getY();
      return(pow((x - center.x), 2) + pow((y - center.y), 2) <= pow(radius, 2));
    }      
    return false;
  }

  @Override
  public void performInteraction(BaseEvent event) {
    setColor();
    setPositionAndRadius();
  }
}
}}}

=3. Handling agents=

{{{
void draw() {
  scene = new TerseHandler();
  agent = new MouseAgent(scene, "my_mouse");
  ...
  scene.handle();
}
}}}